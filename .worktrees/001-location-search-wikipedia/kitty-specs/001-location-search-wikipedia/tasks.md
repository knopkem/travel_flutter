---
description: "Work package task list for Location Search & Wikipedia Browser feature"
---
*Path: kitty-specs/001-location-search-wikipedia/tasks.md*

# Work Packages: Location Search & Wikipedia Browser

**Inputs**: Design documents from `kitty-specs/001-location-search-wikipedia/`
**Prerequisites**: plan.md (technical architecture), spec.md (user stories), research.md (API decisions), data-model.md (entities), contracts/ (API schemas), quickstart.md (developer guide)

**Tests**: No testing required per constitution (testing on-demand only).

**Organization**: Fine-grained subtasks (`Txxx`) roll up into work packages (`WPxx`). Each work package must be independently deliverable and testable.

**Prompt Files**: Each work package references a matching prompt file in `tasks/planned/` generated by `/spec-kitty.tasks`. Treat this file as the high-level checklist; keep deep implementation detail inside the prompt files.

## Subtask Format: `[Txxx] [P?] Description`
- **[P]** indicates the subtask can proceed in parallel (different files/components).
- Include precise file paths or modules.

## Path Conventions
- **Mobile Flutter**: `lib/`, no tests/ (testing not required)

---

## Work Package WP01: Project Setup & Dependencies (Priority: P0)

**Goal**: Initialize Flutter project with dependencies, linting, and project structure.
**Independent Test**: Run `flutter pub get` and `flutter analyze` without errors. Project structure matches plan.md.
**Prompt**: `tasks/planned/WP01-project-setup-dependencies.md`

### Included Subtasks
- [ ] T001 Create pubspec.yaml with dependencies (provider, http, flutter_lints)
- [ ] T002 [P] Configure analysis_options.yaml with flutter_lints
- [ ] T003 [P] Create project directory structure (lib/models/, lib/repositories/, lib/providers/, lib/widgets/, lib/screens/)
- [ ] T004 Create main.dart with MaterialApp scaffold

### Implementation Notes
- Use latest stable versions: provider ^6.1.0, http ^1.1.0, flutter_lints (latest)
- analysis_options.yaml enables flutter_lints package
- Directory structure follows plan.md section "Project Structure"
- main.dart should have basic MaterialApp with placeholder home screen

### Parallel Opportunities
- T002 and T003 can proceed in parallel once pubspec.yaml is created

### Dependencies
- None (starting package)

### Risks & Mitigations
- Version conflicts: Use compatible versions of Flutter 3.x and Dart 3.x
- Linter issues: Address all warnings before proceeding to WP02

---

## Work Package WP02: Data Models & Entities (Priority: P0)

**Goal**: Implement all data model classes (Location, LocationSuggestion, WikipediaContent).
**Independent Test**: Models can be instantiated, convert to/from JSON correctly, and handle edge cases.
**Prompt**: `tasks/planned/WP02-data-models-entities.md`

### Included Subtasks
- [ ] T005 [P] Create lib/models/location.dart with Location class
- [ ] T006 [P] Create lib/models/location_suggestion.dart with LocationSuggestion class
- [ ] T007 [P] Create lib/models/wikipedia_content.dart with WikipediaContent class
- [ ] T008 Add fromJson factories to all model classes
- [ ] T009 Add toLocation() method to LocationSuggestion

### Implementation Notes
- All models use const constructors with final fields (immutable)
- fromJson handles missing/null fields gracefully (see data-model.md)
- Location and LocationSuggestion share similar structure
- WikipediaContent handles optional thumbnail field
- Add Dart doc comments (///) for all public classes and methods

### Parallel Opportunities
- All three model files (T005, T006, T007) can be created in parallel

### Dependencies
- Depends on WP01 (project structure must exist)

### Risks & Mitigations
- JSON parsing errors: Add null safety checks and default values
- Field mismatches: Refer to contracts/nominatim-api.md and contracts/wikipedia-api.md

---

## Work Package WP03: API Repositories (Priority: P0)

**Goal**: Implement repository classes for Nominatim and Wikipedia APIs.
**Independent Test**: Repositories can make HTTP requests, parse responses, and handle errors correctly.
**Prompt**: `tasks/planned/WP03-api-repositories.md`

### Included Subtasks
- [ ] T010 [P] Create lib/repositories/geocoding_repository.dart with GeocodingRepository class
- [ ] T011 [P] Create lib/repositories/wikipedia_repository.dart with WikipediaRepository class
- [ ] T012 Implement search() method in GeocodingRepository (Nominatim API call)
- [ ] T013 Implement getContent() method in WikipediaRepository (Wikipedia API call)
- [ ] T014 Add error handling and custom exceptions for both repositories
- [ ] T015 Add User-Agent header to Nominatim requests

### Implementation Notes
- GeocodingRepository: GET https://nominatim.openstreetmap.org/search
- WikipediaRepository: GET https://en.wikipedia.org/api/rest_v1/page/summary/{title}
- Use http package for requests
- Parse JSON responses into model objects
- Handle network errors, 404s, rate limits (see contracts/)
- Add Dart doc comments for all public methods

### Parallel Opportunities
- T010 and T011 can start in parallel
- T012 and T013 can proceed in parallel after repository classes exist

### Dependencies
- Depends on WP02 (models must exist for fromJson calls)

### Risks & Mitigations
- API changes: Contracts documented in contracts/ folder
- Rate limiting: Debouncing implemented in widgets will handle this
- Network errors: Use try-catch with custom exceptions

---

## Work Package WP04: State Management Providers (Priority: P0)

**Goal**: Implement Provider classes for managing location list and Wikipedia content state.
**Independent Test**: Providers can hold state, notify listeners on changes, and inject repositories correctly.
**Prompt**: `tasks/planned/WP04-state-management-providers.md`

### Included Subtasks
- [ ] T016 [P] Create lib/providers/location_provider.dart with LocationProvider class
- [ ] T017 [P] Create lib/providers/wikipedia_provider.dart with WikipediaProvider class
- [ ] T018 Implement addLocation() and removeLocation() in LocationProvider
- [ ] T019 Implement fetchContent() with loading states in WikipediaProvider
- [ ] T020 Add duplicate prevention logic to LocationProvider
- [ ] T021 Configure MultiProvider in main.dart with both providers

### Implementation Notes
- Both providers extend ChangeNotifier
- LocationProvider manages List<Location> with add/remove operations
- WikipediaProvider manages WikipediaContent? with loading/error states
- Inject repositories via constructor (dependency injection)
- Call notifyListeners() after state changes
- Add Dart doc comments for all public methods

### Parallel Opportunities
- T016 and T017 can start in parallel
- T018 and T019 can proceed in parallel

### Dependencies
- Depends on WP02 (models) and WP03 (repositories)

### Risks & Mitigations
- State synchronization: Ensure notifyListeners() called appropriately
- Memory leaks: Providers are singletons in MultiProvider (safe)

---

## Work Package WP05: User Story 1 - Search and Select City (Priority: P1) ðŸŽ¯ MVP

**Goal**: Implement main screen with search field, autocomplete suggestions, and location button list.
**Independent Test**: User can type "Paris", see suggestions, select one, and see it appear as a button on screen.
**Prompt**: `tasks/planned/WP05-user-story-1-search-select.md`

### Included Subtasks
- [ ] T022 Create lib/screens/home_screen.dart with HomeScreen widget
- [ ] T023 [P] Create lib/widgets/search_field.dart with debounced TextField
- [ ] T024 [P] Create lib/widgets/suggestion_list.dart to display LocationSuggestion items
- [ ] T025 [P] Create lib/widgets/location_button.dart to display saved Location items
- [ ] T026 Implement debouncing logic (300ms Timer) in search_field.dart
- [ ] T027 Wire search_field to call GeocodingRepository via provider
- [ ] T028 Wire suggestion_list selection to LocationProvider.addLocation()
- [ ] T029 Display location buttons using ListView in home_screen.dart
- [ ] T030 Add "No locations found" message for empty search results
- [ ] T031 Handle duplicate location prevention

### Implementation Notes
- HomeScreen uses Scaffold with AppBar and Column layout
- SearchField wraps TextField with debounce logic (Timer)
- SuggestionList displays results in ListView below search field
- LocationButton is a ElevatedButton or Card widget
- Use context.watch<LocationProvider>() for reactive updates
- Clear suggestions when location selected
- Add loading indicator during API calls

### Parallel Opportunities
- T023, T024, T025 (widget files) can be created in parallel
- T026, T027, T028 can proceed after widgets exist

### Dependencies
- Depends on WP03 (repositories) and WP04 (providers)

### Risks & Mitigations
- Debouncing complexity: Use Timer.cancel() on each keystroke
- UI flickering: Ensure suggestions clear appropriately
- Duplicate locations: Check LocationProvider before adding

---

## Work Package WP06: User Story 2 - View Location Information (Priority: P2)

**Goal**: Implement detail screen that fetches and displays Wikipedia content for a location.
**Independent Test**: Tap location button, navigate to detail screen, see Wikipedia summary and thumbnail, navigate back.
**Prompt**: `tasks/planned/WP06-user-story-2-view-information.md`

### Included Subtasks
- [ ] T032 Create lib/screens/location_detail_screen.dart with LocationDetailScreen widget
- [ ] T033 Implement navigation from HomeScreen to LocationDetailScreen (pass Location object)
- [ ] T034 Call WikipediaProvider.fetchContent() on screen init
- [ ] T035 Display loading indicator while fetching (CircularProgressIndicator)
- [ ] T036 Display Wikipedia title, thumbnail (if available), and summary text
- [ ] T037 Add back button in AppBar
- [ ] T038 Handle navigation back to HomeScreen (preserve location list)
- [ ] T039 Display error message if Wikipedia content unavailable
- [ ] T040 Make summary text scrollable (SingleChildScrollView)

### Implementation Notes
- LocationDetailScreen receives Location via Navigator arguments
- Use context.watch<WikipediaProvider>() for state updates
- Show CircularProgressIndicator during loading state
- Display thumbnail with Image.network() if thumbnailUrl exists
- Summary in Text widget wrapped in SingleChildScrollView
- AppBar includes automatic back button
- Error states show user-friendly messages

### Parallel Opportunities
- T033, T034, T035 can proceed after screen widget created
- UI layout tasks (T036, T037, T039, T040) can be refined in parallel

### Dependencies
- Depends on WP04 (WikipediaProvider) and WP05 (HomeScreen for navigation)

### Risks & Mitigations
- Wikipedia page not found: Handle 404 with error message
- Image loading failures: Use errorBuilder in Image.network()
- Long summaries: Ensure scrollable layout

---

## Work Package WP07: User Story 3 - Multiple Locations (Priority: P3)

**Goal**: Enhance UI to handle multiple locations and ensure smooth switching between them.
**Independent Test**: Add 5 locations, scroll through list, tap different buttons, verify correct Wikipedia content loads.
**Prompt**: `tasks/planned/WP07-user-story-3-multiple-locations.md`

### Included Subtasks
- [ ] T041 Make location button list scrollable (wrap in ListView)
- [ ] T042 Ensure WikipediaProvider clears previous content when loading new location
- [ ] T043 Test navigation between multiple locations (state preservation)
- [ ] T044 Add visual feedback when location button is tapped
- [ ] T045 Handle empty state (no locations added yet)

### Implementation Notes
- HomeScreen's location list should already be ListView (from WP05)
- WikipediaProvider should reset state on each fetchContent() call
- Location list persists across navigation back/forth
- Empty state shows helpful message like "Search for a city to get started"
- Button tap shows ripple effect (Material Design default)

### Parallel Opportunities
- T041, T042, T043 can be verified together
- T044, T045 are UI refinements that can be added concurrently

### Dependencies
- Depends on WP05 and WP06 (both screens must be functional)

### Risks & Mitigations
- State leakage: Ensure WikipediaProvider clears old data
- Performance with many locations: ListView handles this efficiently

---

## Work Package WP08: Error Handling & Edge Cases (Priority: P2)

**Goal**: Implement comprehensive error handling for all edge cases identified in spec.
**Independent Test**: Verify error messages appear for: no internet, API unavailable, no results, duplicate locations, special characters.
**Prompt**: `tasks/planned/WP08-error-handling-edge-cases.md`

### Included Subtasks
- [ ] T046 Add "No internet connection" error handling in both repositories
- [ ] T047 Add "Service unavailable" error handling for API 503 responses
- [ ] T048 Add "No locations found" message for empty search results (already in WP05, verify)
- [ ] T049 Add "Location already added" duplicate prevention message
- [ ] T050 Handle special characters and Unicode in search queries (URL encoding)
- [ ] T051 Handle orientation changes (ensure state preserved)
- [ ] T052 Add rate limit handling for Nominatim (429 response)

### Implementation Notes
- Use SocketException for no internet detection
- Show SnackBar for transient errors (network, rate limit)
- Show centered Text widget for empty states
- URL encode location names before API calls (Uri.encodeComponent)
- Flutter handles orientation changes automatically if state in Provider
- Rate limit should not occur due to debouncing, but handle gracefully

### Parallel Opportunities
- Error handling tasks can be implemented across different files in parallel
- T046, T047, T050, T052 are repository-level
- T048, T049, T051 are UI-level

### Dependencies
- Depends on WP03, WP05, WP06 (repositories and screens must exist)

### Risks & Mitigations
- Missing error cases: Refer to spec.md "Edge Cases" section
- User confusion: Ensure all error messages are actionable

---

## Work Package WP09: Documentation & Code Quality (Priority: P2)

**Goal**: Add comprehensive Dart doc comments and ensure code quality standards met.
**Independent Test**: Run `flutter analyze` with zero warnings. All public APIs have doc comments.
**Prompt**: `tasks/planned/WP09-documentation-code-quality.md`

### Included Subtasks
- [ ] T053 Add Dart doc comments (///) to all model classes and methods
- [ ] T054 Add Dart doc comments to all repository classes and methods
- [ ] T055 Add Dart doc comments to all provider classes and methods
- [ ] T056 Add inline comments for complex logic (debouncing, API parsing)
- [ ] T057 Run `dart format .` to format all code
- [ ] T058 Run `flutter analyze` and fix all warnings
- [ ] T059 Create README.md in project root with app description and setup instructions
- [ ] T060 Review code against constitution principles (modular architecture, modern dependencies, quality)

### Implementation Notes
- Dart doc comments use /// format above declarations
- Document parameters, return values, and exceptions
- Inline comments explain non-obvious logic (why, not what)
- dart format enforces consistent style
- README.md includes: purpose, setup steps, running instructions
- Constitution check: verify all 5 principles satisfied

### Parallel Opportunities
- Documentation tasks (T053-T056) can be done in parallel across files
- T057, T058 are sequential checks
- T059, T060 are final verification steps

### Dependencies
- Depends on WP05, WP06, WP07, WP08 (all code must be complete)

### Risks & Mitigations
- Incomplete documentation: Review all public APIs
- Linter warnings: Address immediately (constitution requirement)

---

## Work Package WP10: Final Integration & Polish (Priority: P3)

**Goal**: Final integration testing, visual polish, and ensure smooth user experience.
**Independent Test**: Complete end-to-end user journey: search â†’ select â†’ view â†’ back â†’ search again.
**Prompt**: `tasks/planned/WP10-final-integration-polish.md`

### Included Subtasks
- [ ] T061 Test complete user journey (search multiple cities, view Wikipedia content, navigate back)
- [ ] T062 Verify 300ms debounce working correctly (not too fast, not too slow)
- [ ] T063 Verify loading indicators appear during API calls
- [ ] T064 Verify error messages are user-friendly and actionable
- [ ] T065 Polish UI spacing, padding, and alignment
- [ ] T066 Verify app works on both iOS and Android simulators/devices
- [ ] T067 Test with slow network (simulate API delays)
- [ ] T068 Verify state preservation across screen navigation

### Implementation Notes
- Manual testing of complete user flows
- Use Flutter DevTools for performance monitoring (60fps check)
- Test on both platforms if possible
- Simulate slow network in device settings or with throttling
- Verify search debounce by typing quickly and observing API calls
- Check visual consistency with Material Design guidelines

### Parallel Opportunities
- Testing can be distributed across team members
- iOS and Android testing can proceed in parallel

### Dependencies
- Depends on all previous work packages (complete feature must exist)

### Risks & Mitigations
- Platform-specific issues: Test early on both platforms
- Performance problems: Monitor with DevTools
- UX issues: Get user feedback if possible

---

## Dependency & Execution Summary

**Sequence**: 
- WP01 â†’ WP02 â†’ WP03 â†’ WP04 â†’ WP05 (MVP ready) â†’ WP06 â†’ WP07 â†’ WP08 â†’ WP09 â†’ WP10

**Parallelization Highlights**:
- WP02: All 3 model files can be created in parallel
- WP03: Both repository files can be created in parallel
- WP04: Both provider files can be created in parallel
- WP05: Widget files (search_field, suggestion_list, location_button) can be created in parallel
- WP08: Error handling can be added across files in parallel
- WP09: Documentation can be added to files in parallel

**MVP Scope**: WP01 through WP05 constitute the minimal viable product
- User can search for cities
- User can select cities and see them as buttons
- Basic functionality complete
- Future work packages add detail view, multiple locations, polish

**Critical Path**: WP01 â†’ WP02 â†’ WP03 â†’ WP04 â†’ WP05 (MVP)
**Total Work Packages**: 10
**Total Subtasks**: 68

---

## Subtask Index (Reference)

| Subtask ID | Summary | Work Package | Priority | Parallel? |
|------------|---------|--------------|----------|-----------|
| T001 | Create pubspec.yaml with dependencies | WP01 | P0 | No |
| T002 | Configure analysis_options.yaml | WP01 | P0 | Yes |
| T003 | Create project directory structure | WP01 | P0 | Yes |
| T004 | Create main.dart scaffold | WP01 | P0 | No |
| T005 | Create Location model | WP02 | P0 | Yes |
| T006 | Create LocationSuggestion model | WP02 | P0 | Yes |
| T007 | Create WikipediaContent model | WP02 | P0 | Yes |
| T008 | Add fromJson factories | WP02 | P0 | No |
| T009 | Add toLocation() method | WP02 | P0 | No |
| T010 | Create GeocodingRepository | WP03 | P0 | Yes |
| T011 | Create WikipediaRepository | WP03 | P0 | Yes |
| T012 | Implement search() method | WP03 | P0 | Yes |
| T013 | Implement getContent() method | WP03 | P0 | Yes |
| T014 | Add error handling to repositories | WP03 | P0 | No |
| T015 | Add User-Agent header | WP03 | P0 | No |
| T016 | Create LocationProvider | WP04 | P0 | Yes |
| T017 | Create WikipediaProvider | WP04 | P0 | Yes |
| T018 | Implement location CRUD methods | WP04 | P0 | Yes |
| T019 | Implement fetchContent with states | WP04 | P0 | Yes |
| T020 | Add duplicate prevention | WP04 | P0 | No |
| T021 | Configure MultiProvider | WP04 | P0 | No |
| T022 | Create HomeScreen | WP05 | P1 | No |
| T023 | Create SearchField widget | WP05 | P1 | Yes |
| T024 | Create SuggestionList widget | WP05 | P1 | Yes |
| T025 | Create LocationButton widget | WP05 | P1 | Yes |
| T026 | Implement debouncing | WP05 | P1 | No |
| T027 | Wire search to repository | WP05 | P1 | No |
| T028 | Wire selection to provider | WP05 | P1 | No |
| T029 | Display location buttons | WP05 | P1 | No |
| T030 | Add empty search message | WP05 | P1 | No |
| T031 | Handle duplicate prevention | WP05 | P1 | No |
| T032 | Create LocationDetailScreen | WP06 | P2 | No |
| T033 | Implement navigation | WP06 | P2 | No |
| T034 | Call fetchContent on init | WP06 | P2 | No |
| T035 | Display loading indicator | WP06 | P2 | No |
| T036 | Display Wikipedia content | WP06 | P2 | No |
| T037 | Add back button | WP06 | P2 | No |
| T038 | Handle navigation back | WP06 | P2 | No |
| T039 | Display error message | WP06 | P2 | No |
| T040 | Make summary scrollable | WP06 | P2 | No |
| T041 | Make location list scrollable | WP07 | P3 | No |
| T042 | Clear previous content on load | WP07 | P3 | No |
| T043 | Test multi-location navigation | WP07 | P3 | No |
| T044 | Add button tap feedback | WP07 | P3 | No |
| T045 | Handle empty state | WP07 | P3 | No |
| T046 | Handle no internet error | WP08 | P2 | Yes |
| T047 | Handle service unavailable | WP08 | P2 | Yes |
| T048 | Verify no results message | WP08 | P2 | Yes |
| T049 | Add duplicate location message | WP08 | P2 | Yes |
| T050 | Handle special characters | WP08 | P2 | Yes |
| T051 | Handle orientation changes | WP08 | P2 | Yes |
| T052 | Handle rate limit | WP08 | P2 | Yes |
| T053 | Document model classes | WP09 | P2 | Yes |
| T054 | Document repository classes | WP09 | P2 | Yes |
| T055 | Document provider classes | WP09 | P2 | Yes |
| T056 | Add inline comments | WP09 | P2 | Yes |
| T057 | Run dart format | WP09 | P2 | No |
| T058 | Run flutter analyze | WP09 | P2 | No |
| T059 | Create README.md | WP09 | P2 | No |
| T060 | Review constitution compliance | WP09 | P2 | No |
| T061 | Test end-to-end journey | WP10 | P3 | No |
| T062 | Verify debounce timing | WP10 | P3 | No |
| T063 | Verify loading indicators | WP10 | P3 | No |
| T064 | Verify error messages | WP10 | P3 | No |
| T065 | Polish UI spacing | WP10 | P3 | No |
| T066 | Test on both platforms | WP10 | P3 | No |
| T067 | Test with slow network | WP10 | P3 | No |
| T068 | Verify state preservation | WP10 | P3 | No |

---

> All work packages are ready for implementation. Refer to individual prompt files in `tasks/planned/` for detailed execution guidance.
